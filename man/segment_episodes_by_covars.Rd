% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/episodes.R
\name{segment_episodes_by_covars}
\alias{segment_episodes_by_covars}
\title{Segment time series data into episodes with covariate change tracking}
\usage{
segment_episodes_by_covars(
  .data,
  date_col,
  covar_cols,
  max_date = NULL,
  gap_threshold = Inf,
  gap_unit = "days",
  inactive_threshold = gap_threshold,
  inactive_unit = gap_unit,
  episodes = "all",
  progress = TRUE
)
}
\arguments{
\item{.data}{A data frame with time series data}

\item{date_col}{Column containing date values to analyze}

\item{covar_cols}{Columns to monitor for changes that trigger segmentation}

\item{max_date}{Optional reference date for determining active/inactive status
Defaults to the maximum date in the dataset}

\item{gap_threshold}{Numeric value specifying the gap size that defines a new episode
Default is Inf}

\item{gap_unit}{Units for the gap threshold. One of "days", "weeks", or "months"
Default is "days"}

\item{inactive_threshold}{Threshold for considering an episode inactive
Default is the same as \code{gap_threshold}}

\item{inactive_unit}{Units for the inactive threshold. One of "days", "weeks", or "months"
Default is the same as \code{gap_unit}}

\item{episodes}{Which episodes to return. Options are "all", "first", "last", or a
specific episode number. Default is "all"}

\item{progress}{Logical. Display a progress bar while processing? Default is TRUE}
}
\value{
A data frame with one row per segment containing:
\itemize{
\item \strong{episode_id}: Numeric episode identifier
\item \strong{segment_id}: String segment identifier (format: "episode.segment")
\item \strong{episode_start}: Date when the episode started
\item \strong{episode_end}: Date when the episode ended
\item \strong{segment_start}: Date when the segment started
\item \strong{segment_end}: Date when the segment ended
\item \strong{episode_days}: Duration of the episode in days
\item \strong{segment_days}: Duration of the segment in days
\item \strong{discontinued}: Logical indicating if the segment is discontinued
\item \strong{status}: Character indicating segment status ("Active", "Inactive", "Gap", or "Ongoing")
\item \strong{dates_count}: Number of dates in the segment
\item \strong{dates_avg_days_between}: Average number of days between consecutive dates in the segment
\item \strong{dates_sd_days_between}: Standard deviation of days between consecutive dates
\item \strong{gap_days}: Number of days between this segment and the next one (NA for the last segment)
\item \strong{covariates}: Columns specified in covar_cols
\item \strong{other variables}: Any fixed variables from the input data frame
}
}
\description{
\code{segment_episodes_by_covars()} identifies episodes in temporal data by detecting gaps
between dates that exceed a specified threshold, and further segments these
episodes when covariate values change. An episode ends when the gap between
consecutive dates is larger than \code{gap_threshold}. Within each episode, segments
are created whenever covariate values change.
}
\examples{
data(substance_use)
treatment_episodes_by_covars <- substance_use |>
  group_by(client_id) |>
  segment_episodes_by_covars(
    visit_date,
    covar_cols = c("substance_use_past_week", "quality_of_life_score", "medication_dose_mg"),
    gap_threshold = 2,
    gap_unit = "months"
  )

}
\seealso{
\code{\link{segment_episodes}} for creating episode segments without tracking covariate changes
}
